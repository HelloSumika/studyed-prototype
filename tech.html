<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>StudyEd — AI Smart Team Formation</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Montserrat:wght@600;800&display=swap" rel="stylesheet">
<script src="https://unpkg.com/lottie-web/build/player/lottie.min.js"></script>

<style>
  :root{
    --bg-1: #061226;
    --bg-2: #071827;
    --card: #0f1724;
    --muted: #9faeb8;
    --accent: #3a8dff;
    --accent2: #00d1b2;
    --glass: rgba(255,255,255,0.03);
    --maxw: 1200px;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;background:linear-gradient(180deg,var(--bg-1),var(--bg-2));color:#eaf7f1; -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;}
  a{color:inherit}
  .container{max-width:var(--maxw);margin:0 auto;padding:20px}
  /* NAV */
  nav{display:flex;align-items:center;justify-content:space-between;padding:18px 0}
  .brand{display:flex;gap:12px;align-items:center}
  .logo{width:48px;height:48px;border-radius:10px;background:linear-gradient(135deg,var(--accent),var(--accent2));display:flex;align-items:center;justify-content:center;font-weight:800}
  .brand h3{margin:0;font-family:Montserrat, sans-serif}
  .nav-links{display:flex;gap:18px;align-items:center}
  .nav-links a{color:var(--muted);text-decoration:none;font-size:14px}
  .btn-ghost{padding:8px 12px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--muted);text-decoration:none}
  .btn-primary{padding:10px 14px;border-radius:10px;background:linear-gradient(90deg,var(--accent),var(--accent2));color:#041224;font-weight:700;border:none;cursor:pointer}
  /* Hero */
  .hero{display:grid;grid-template-columns:1fr 480px;gap:28px;align-items:center;padding:40px 0}
  .hero h1{font-size:34px;line-height:1.02;margin:0;font-family:Montserrat}
  .lead{color:var(--muted);margin-top:8px}
  .hero-ctas{display:flex;gap:10px;margin-top:18px}
  /* Blobs and visual */
  .visual-wrap{position:relative;width:100%;height:320px;border-radius:18px;overflow:hidden;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.03)}
  svg.blobs{position:absolute;inset:0;width:100%;height:100%}
  .mockcard{position:absolute;right:22px;bottom:22px;width:260px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;padding:12px;border:1px solid rgba(255,255,255,0.03);backdrop-filter:blur(4px)}
  .mockcard .avatar{display:inline-flex;width:34px;height:34px;border-radius:8px;background:#0e2330;align-items:center;justify-content:center;color:#9fd6ff;margin-right:8px;font-weight:700}
  /* Sections */
  .section{padding:40px 0}
  .features{display:grid;grid-template-columns:repeat(3,1fr);gap:18px}
  .feature{background:var(--card);padding:18px;border-radius:12px;border:1px solid rgba(255,255,255,0.02);transition:transform .18s ease, box-shadow .18s ease}
  .feature:hover{transform:translateY(-6px);box-shadow:0 10px 30px rgba(0,0,0,0.45)}
  .feature h4{margin:0 0 8px}
  /* Demo area (embedded) */
  .demo-wrap{display:grid;grid-template-columns:1fr 480px;gap:18px;align-items:start}
  .card{background:var(--card);padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.02)}
  input, select, textarea{width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:inherit}
  button{background:var(--accent);color:#041224;border:none;padding:8px 12px;border-radius:8px;cursor:pointer}
  .student{display:flex;align-items:center;gap:10px;padding:8px;border-radius:8px;background:linear-gradient(90deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));margin-bottom:8px}
  .small{font-size:13px;color:var(--muted)}
  /* Footer */
  footer{padding:24px 0;border-top:1px solid rgba(255,255,255,0.02);color:var(--muted)}
  /* responsiveness */
  @media (max-width:1100px){ .hero{grid-template-columns:1fr} .demo-wrap{grid-template-columns:1fr} .features{grid-template-columns:1fr 1fr} }
  @media (max-width:760px){ .features{grid-template-columns:1fr} .nav-links{display:none} }
  /* reduced motion */
  @media (prefers-reduced-motion: reduce){ *{animation:none!important; transition:none!important} }
  /* tiny helpers */
  .muted{color:var(--muted)}
  .pill{display:inline-block;background:rgba(255,255,255,0.03);padding:6px 10px;border-radius:999px}
</style>
</head>
<body>

<!-- NAV -->
<div class="container">
  <nav>
    <div class="brand">
      <div class="logo">SE</div>
      <div><h3>StudyEd</h3><div class="small muted">AI-driven team formation</div></div>
    </div>
    <div class="nav-links">
      <a href="#how">How</a>
      <a href="#features">Features</a>
      <a href="#demo">Demo</a>
      <a class="btn-ghost" href="https://github.com/yourusername/studyed" target="_blank">View code</a>
      <a class="btn-primary" href="#demo">Try demo</a>
    </div>
  </nav>
</div>

<!-- HERO -->
<div class="container">
  <section class="hero" id="top">
    <div>
      <h1>Make group work fair, productive and career-ready — with AI</h1>
      <p class="lead">StudyEd intelligently forms teams using students’ learning styles (VARK), skills and professional interests so every project is a learning & CV opportunity.</p>
      <div class="hero-ctas">
        <a class="btn-primary" href="#demo">Try demo</a>
        <a class="btn-ghost" href="#features">See features</a>
      </div>
      <div style="margin-top:18px" class="small muted">Pilots ready for integration with Moodle, MS Teams and Google Classroom • GDPR-first design</div>
    </div>

    <div>
      <div class="visual-wrap" aria-hidden="true">
        <!-- SVG blobs -->
        <svg class="blobs" viewBox="0 0 800 480" preserveAspectRatio="none">
          <defs><linearGradient id="g1" x1="0" x2="1"><stop offset="0" stop-color="#3a8dff"/><stop offset="1" stop-color="#6a4dff"/></linearGradient></defs>
          <ellipse cx="120" cy="100" rx="120" ry="80" fill="url(#g1)" opacity="0.9" style="filter: blur(22px)"></ellipse>
          <ellipse cx="560" cy="120" rx="160" ry="100" fill="#00d1b2" opacity="0.8" style="filter: blur(28px)"></ellipse>
          <ellipse cx="420" cy="360" rx="200" ry="120" fill="#ff7f50" opacity="0.75" style="filter: blur(34px)"></ellipse>
        </svg>

        <!-- Lottie container -->
        <div id="heroLottie" style="position:absolute;left:40px;top:40px;width:360px;height:240px"></div>

        <!-- mockcard -->
        <div class="mockcard" role="group" aria-label="Example match card">
          <div style="display:flex;align-items:center">
            <div class="avatar">AK</div>
            <div style="margin-left:8px">
              <div style="font-weight:700">Team Match — Consulting</div>
              <div class="small muted">Compatibility: <span style="color:#9fe7ff">89%</span></div>
            </div>
          </div>
          <div style="margin-top:10px;font-size:13px" class="small muted">Presenter · Analyst · Researcher</div>
        </div>
      </div>
    </div>
  </section>
</div>

<!-- HOW IT WORKS -->
<div class="container">
  <section id="how" class="section">
    <h2 style="margin:0 0 12px">How StudyEd works</h2>
    <div class="features" id="features">
      <div class="feature">
        <h4>1. Quick Profile</h4>
        <div class="small muted">Students complete a 3-min adaptive form: VARK + skills + preferred roles + career interests.</div>
      </div>
      <div class="feature">
        <h4>2. AI Matching</h4>
        <div class="small muted">Clustering and complementarity scoring ensure balanced teams with high compatibility and role coverage.</div>
      </div>
      <div class="feature">
        <h4>3. Team Starter Pack</h4>
        <div class="small muted">Auto-generated roles, task plan, CV skill tags and rehearsal checklist to help groups hit deadlines.</div>
      </div>
    </div>
  </section>
</div>

<!-- FEATURES / VALUE -->
<div class="container">
  <section class="section">
    <div style="display:flex;gap:20px;align-items:flex-start">
      <div style="flex:1">
        <h3 style="margin:0 0 8px">Why it matters</h3>
        <p class="muted small">Better matches -> less conflict, more engagement and clear career relevance for students. Faculty spend less time managing teams and get higher-quality submissions.</p>
        <ul class="small muted" style="margin-top:12px">
          <li>Career-aligned teams for CV-ready projects</li>
          <li>Data-driven fairness and explainability</li>
          <li>Plug & play for existing LMS</li>
        </ul>
      </div>
      <div style="width:420px">
        <div style="background:var(--card);padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.03)">
          <strong>Use case</strong>
          <div class="small muted" style="margin-top:8px">Consulting students automatically grouped into presentation-heavy teams; design students grouped for portfolio projects.</div>
        </div>
      </div>
    </div>
  </section>
</div>

<!-- DEMO (embedded original app) -->
<div class="container">
  <section id="demo" class="section">
    <h2 style="margin:0 0 12px">Interactive demo</h2>
    <div class="demo-wrap" style="gap:18px">
      <!-- LEFT: original single-file demo controls (kept) -->
      <div>
        <div class="card" role="region" aria-label="Add profile">
          <strong>Add / Edit Student Profile</strong>
          <div class="small muted">3-min profile: career tags, skills, roles, and VARK sliders.</div>
          <label class="small muted">Name <input id="name" type="text"></label>
          <label class="small muted">Career interests (comma) <input id="interests" type="text" placeholder="consulting, marketing"></label>
          <label class="small muted">Skills (comma) <input id="skills" type="text" placeholder="presenting, analysis"></label>
          <label class="small muted">Preferred roles (comma) <input id="roles" type="text" placeholder="presenter, analyst"></label>
          <div style="display:flex;gap:8px;margin-top:8px">
            <input id="vark_v" type="number" min="0" max="100" value="25" aria-label="VARK Visual"/>
            <input id="vark_a" type="number" min="0" max="100" value="25" aria-label="VARK Aural"/>
            <input id="vark_r" type="number" min="0" max="100" value="25" aria-label="VARK ReadWrite"/>
            <input id="vark_k" type="number" min="0" max="100" value="25" aria-label="VARK Kinesthetic"/>
          </div>
          <div style="display:flex;gap:8px;margin-top:10px">
            <button id="addBtn">Add profile</button>
            <button id="seedBtn" style="background:var(--accent2)">Load sample</button>
            <button id="clearBtn" style="background:#ff7b7b">Clear all</button>
            <div style="margin-left:auto" class="small muted">Profiles: <span id="count">0</span></div>
          </div>
        </div>

        <div class="card" style="margin-top:12px" role="region" aria-label="Assignment">
          <strong>Teacher — Assignment & Weights</strong>
          <label class="small muted">Assignment name <input id="assignmentName" type="text" placeholder="Consulting pitch"></label>
          <label class="small muted">Group size <input id="groupSize" type="number" min="2" max="8" value="4"></label>
          <label class="small muted">Required roles (comma) <input id="reqRoles" type="text" placeholder="presenter, analyst"></label>
          <div style="display:flex;gap:8px;margin-top:8px">
            <div style="flex:1"><label class="small muted">Career weight <input id="wInterest" type="range" min="0" max="100" value="55"></label></div>
            <div style="flex:1"><label class="small muted">VARK weight <input id="wVark" type="range" min="0" max="100" value="30"></label></div>
            <div style="flex:1"><label class="small muted">Role weight <input id="wRole" type="range" min="0" max="100" value="15"></label></div>
          </div>
          <div style="display:flex;gap:8px;margin-top:10px">
            <button id="matchBtn">Run match</button>
            <button id="exportCsvBtn" style="background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted)">Export CSV</button>
            <button id="exportJsonBtn" style="background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted)">Export JSON</button>
            <button id="importJsonBtn" style="background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted)">Import JSON</button>
          </div>
        </div>

        <div class="card" style="margin-top:12px" role="region" aria-label="Profiles">
          <strong>Profiles</strong>
          <div id="studentList" style="max-height:360px;overflow:auto;margin-top:8px" aria-live="polite"></div>
        </div>
      </div>

      <!-- RIGHT: groups + explain -->
      <div>
        <div class="card" role="region" aria-label="Groups and starter packs">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <strong>Groups & Starter Packs</strong>
            <div class="small muted">Click a group to see scoring & starter pack</div>
          </div>
          <div id="groupsArea" style="margin-top:10px"></div>
        </div>

        <div class="card" style="margin-top:12px">
          <strong>Explainability</strong>
          <pre id="explainArea" tabindex="0" aria-live="polite" style="height:220px;overflow:auto">Select a group to see details.</pre>
        </div>
      </div>
    </div>
  </section>
</div>

<!-- TESTIMONIALS + FAQ (short) -->
<div class="container">
  <section class="section">
    <div style="display:flex;gap:18px;align-items:flex-start">
      <div style="flex:1">
        <h4 style="margin:0 0 8px">What instructors say</h4>
        <div class="card" style="padding:14px">
          <div style="font-weight:700">“Saved me hours setting up groups — and the teams were better”</div>
          <div class="small muted" style="margin-top:8px">— Lecturer, Business School</div>
        </div>
      </div>
      <div style="width:360px">
        <h4 style="margin:0 0 8px">FAQ</h4>
        <div class="card" style="padding:12px">
          <strong>Is it GDPR compliant?</strong>
          <div class="small muted">Demo stores local profiles. Production requires opt-in, anonymisation and retention rules (we include design in README).</div>
        </div>
      </div>
    </div>
  </section>
</div>

<!-- FOOTER -->
<div class="container">
  <footer>
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div>© StudyEd • Demo — <a href="https://github.com/yourusername/studyed" target="_blank">GitHub</a></div>
      <div class="small muted">Built for hackathon demos — replace Lottie & images for production</div>
    </div>
  </footer>
</div>

<!-- SCRIPT: matching + UI logic (mostly preserved + minor hooks) -->
<script>
/*  StudyEd: landing + demo combined
    - matching engine preserved from prior version
    - localStorage, JSON import/export maintained
    - hero Lottie animation loaded
*/

// ---------- small utilities ----------
const uid = ()=>Math.random().toString(36).slice(2,9);
const clamp = (v,a,b)=>Math.max(a,Math.min(b,v));
const avg = arr => arr.reduce((s,x)=>s+x,0)/Math.max(1,arr.length);

// seeded RNG (deterministic demo)
function mulberry32(seed){ return function(){ seed |= 0; seed = seed + 0x6D2B79F5 | 0; let t = Math.imul(seed ^ seed >>> 15, 1 | seed); t = t + Math.imul(t ^ t >>> 7, 61 | t) ^ t; return ((t ^ t >>> 14) >>> 0) / 4294967296; }; }
const rng = mulberry32(20251127);

// ---------- data ----------
let students = [];
let groups = [];

// ---------- text processing & vectors ----------
function tokenize(s){ return (s||'').toLowerCase().split(/[^a-z0-9]+/).filter(Boolean); }
function buildVocab(){ const set=new Set(); students.forEach(s=>{ s.interests.forEach(i=>tokenize(i).forEach(t=>set.add(t))); s.skills.forEach(k=>tokenize(k).forEach(t=>set.add(t))); }); return Array.from(set); }
function textVecFor(s, vocab){ const vec=new Array(vocab.length).fill(0); const tokens=tokenize((s.interests||[]).join(' ') + ' ' + (s.skills||[]).join(' ')); tokens.forEach(t=>{ const i=vocab.indexOf(t); if(i>=0) vec[i]+=1;}); return vec; }
function dot(a,b){ let s=0; for(let i=0;i<a.length;i++) s+=a[i]*b[i]; return s; }
function norm(a){ return Math.sqrt(a.reduce((s,x)=>s+x*x,0)); }
function cosine(a,b){ const na=norm(a), nb=norm(b); if(na===0||nb===0) return 0; return dot(a,b)/(na*nb); }

// ---------- VARK ----------
function normalizedVark(v){ const s=(v.v||0)+(v.a||0)+(v.r||0)+(v.k||0) || 1; return [(v.v||0)/s,(v.a||0)/s,(v.r||0)/s,(v.k||0)/s]; }
function combinedVec(s, vocab, wText=1, wVark=1){ const t=textVecFor(s,vocab); const tnorm=norm(t)||1; const textNormalized=t.map(x=>x/tnorm * wText); const v=normalizedVark(s.vark).map(x=>x*wVark); return textNormalized.concat(v); }

// ---------- simple kmeans ----------
function kmeans(data, k=2, iters=20){
  const dim = data[0].length; const centers=[]; const used=new Set();
  while(centers.length<k){ const idx=Math.floor(rng()*data.length); if(!used.has(idx)){ used.add(idx); centers.push(data[idx].slice()); } }
  let assign=new Array(data.length).fill(0);
  for(let it=0; it<iters; it++){
    let moved=false;
    for(let i=0;i<data.length;i++){
      let best=0,bestd=-Infinity;
      for(let c=0;c<k;c++){ const sim = cosine(data[i], centers[c]); if(sim>bestd){ bestd=sim; best=c; } }
      if(assign[i]!==best){ moved=true; assign[i]=best; }
    }
    if(!moved) break;
    for(let c=0;c<k;c++){ const sum=new Array(dim).fill(0); let cnt=0; for(let i=0;i<data.length;i++) if(assign[i]===c){ for(let d=0; d<dim; d++) sum[d]+=data[i][d]; cnt++; } if(cnt>0) for(let d=0; d<dim; d++) centers[c][d] = sum[d]/cnt; }
  }
  return {assign, centers};
}

// ---------- scoring ----------
function varkVariance(groupIds){ const arr = groupIds.map(id => normalizedVark(students.find(s=>s.id===id).vark)); const means=[0,0,0,0]; arr.forEach(a=>{ for(let i=0;i<4;i++) means[i]+=a[i]/arr.length; }); const vars=[0,0,0,0]; arr.forEach(a=>{ for(let i=0;i<4;i++){ const d=a[i]-means[i]; vars[i]+=d*d/arr.length; }}); const std=Math.sqrt((vars[0]+vars[1]+vars[2]+vars[3])/4); return clamp(std,0,1); }
function roleCoverage(groupIds, reqRoles){ if(!reqRoles||reqRoles.length===0) return 1; let covered=0; reqRoles.forEach(r=>{ const rr=r.toLowerCase(); if(groupIds.some(id=>students.find(s=>s.id===id).roles.map(x=>x.toLowerCase()).includes(rr))) covered++; }); return covered/reqRoles.length; }
function avgPairwiseTextSim(groupIds, textEmbeddings){ if(groupIds.length<2) return 0.5; let sum=0,count=0; const idxs = groupIds.map(id=>students.findIndex(s=>s.id===id)); for(let i=0;i<idxs.length;i++) for(let j=i+1;j<idxs.length;j++){ sum+=cosine(textEmbeddings[idxs[i]], textEmbeddings[idxs[j]]); count++; } return count ? sum/count : 0; }

// ---------- match engine ----------
function matchEngine(groupSize, requiredRoles, weights){
  groups = [];
  if(students.length < groupSize) return groups;
  const vocab = buildVocab();
  const textEmb = students.map(s => textVecFor(s, vocab));
  const combined = students.map(s => combinedVec(s, vocab, weights.interest, weights.vark));
  const k = Math.max(1, Math.ceil(students.length / groupSize));
  const {assign} = kmeans(combined, k, 25);
  const buckets = {};
  assign.forEach((c, idx)=>{ buckets[c] = buckets[c] || []; buckets[c].push(students[idx].id); });
  const assembled = [];
  Object.values(buckets).forEach(bucket=>{
    const pool = bucket.slice();
    while(pool.length >= groupSize){
      pool.sort((a,b)=> { const A = students.find(s=>s.id===a), B = students.find(s=>s.id===b); return (B.interests.length + B.skills.length) - (A.interests.length + A.skills.length); });
      const seed = pool.shift();
      const group = [seed];
      while(group.length < groupSize){
        let best=-Infinity,bestId=null;
        pool.forEach(candidate=>{
          const candGroup = group.concat([candidate]);
          const sim = avgPairwiseTextSim(candGroup, textEmb);
          const vvar = varkVariance(candGroup);
          const rcov = roleCoverage(candGroup, requiredRoles);
          const score = weights.interest*sim + weights.vark*(1 - vvar) + weights.role*rcov;
          if(score > best){ best=score; bestId=candidate; }
        });
        if(!bestId) break;
        group.push(bestId);
        pool.splice(pool.indexOf(bestId),1);
      }
      assembled.push({members: group, score: Math.round((weights.interest*avgPairwiseTextSim(group,textEmb) + weights.vark*(1 - varkVariance(group)) + weights.role*roleCoverage(group,requiredRoles))*100)});
    }
    if(pool.length>0) assembled.push({members: pool.splice(0), score:0});
  });
  const finals = assembled.filter(g=>g.members.length>0);
  const smallGroups = finals.filter(g=>g.members.length < groupSize);
  smallGroups.forEach(sg=>{
    let mems = sg.members.slice();
    while(mems.length){
      finals.sort((a,b)=>a.members.length - b.members.length);
      finals[0].members.push(mems.shift());
    }
  });
  finals.forEach(g=> g.score = Math.round((weights.interest*avgPairwiseTextSim(g.members,textEmb) + weights.vark*(1 - varkVariance(g.members)) + weights.role*roleCoverage(g.members,requiredRoles))*100));
  groups = finals;
  return groups;
}

// ---------- starter pack ----------
function starterPackFor(group){
  const members = group.members.map(id=>students.find(s=>s.id===id));
  const topCareerCounts = {};
  members.forEach(m=> m.interests.forEach(i => topCareerCounts[i] = (topCareerCounts[i]||0)+1));
  const topCareer = Object.keys(topCareerCounts).sort((a,b)=>topCareerCounts[b]-topCareerCounts[a])[0] || 'General';
  const assign = {};
  members.forEach(m => assign[m.name] = (m.roles && m.roles[0]) ? m.roles[0] : 'Member');
  const bullets = [
    `Project focus: ${topCareer}`,
    `Team members: ${members.map(m=>m.name).join(', ')}`,
    `Assigned roles: ${Object.entries(assign).map(([n,r])=>`${n} → ${r}`).join('; ')}`,
    `Kickoff: 20–30 min alignment meeting; split research & slides; schedule rehearsal.`,
    `Deliverables: 10-min presentation (max 10 slides), 1-page exec summary.`,
    `Tip: use rehearsal recordings for iterative feedback.`
  ];
  const roleSpecs = Object.entries(assign).map(([n,r])=>({
    name:n, role:r, bullets: [
      `Top responsibility: deliver ${r} components.`,
      `Success metric: completed artifact & rehearsal contribution.`,
      `Tip: commit 1-2 small tasks in first meeting.`
    ]
  }));
  return {title:`Starter Pack — ${topCareer}`, bullets, roleSpecs};
}

// ---------- UI rendering ----------
function renderProfiles(){
  const el = document.getElementById('studentList'); el.innerHTML='';
  students.forEach(s=>{
    const div = document.createElement('div'); div.className='student';
    const initials = (s.name||'').split(' ').map(x=>x[0]).slice(0,2).join('').toUpperCase() || 'S';
    div.innerHTML = `<div style="width:40px;height:40px;border-radius:8px;background:#09202a;display:flex;align-items:center;justify-content:center;color:#9fe7ff;font-weight:700">${initials}</div>
      <div style="flex:1">
        <strong>${escapeHtml(s.name)}</strong>
        <div class="small muted">${escapeHtml(s.interests.join(', '))}</div>
        <div class="small muted">skills: ${escapeHtml(s.skills.join(', '))} · roles: ${escapeHtml(s.roles.join(', '))}</div>
      </div>
      <div style="text-align:right"><div class="small muted">V:${s.vark.v} A:${s.vark.a} R:${s.vark.r} K:${s.vark.k}</div>
      <div style="margin-top:8px"><button style="background:#ff6b6b;color:#fff;border:none;padding:6px;border-radius:6px" onclick="removeProfile('${s.id}')">Remove</button></div></div>`;
    el.appendChild(div);
  });
  document.getElementById('count').textContent = students.length;
}

function renderGroups(){
  const area = document.getElementById('groupsArea'); area.innerHTML='';
  if(groups.length===0){ area.innerHTML = '<div class="small muted">No groups generated yet</div>'; return; }
  groups.forEach((g,i)=>{
    const card = document.createElement('div'); card.className='card'; card.style.marginBottom='12px';
    card.innerHTML = `<div style="display:flex;justify-content:space-between;align-items:center"><strong>Group ${i+1}</strong><div class="pill">${g.score}%</div></div>`;
    const membersHtml = g.members.map(id=>{
      const s = students.find(x=>x.id===id);
      return `<div style="display:flex;justify-content:space-between;padding:8px 0"><div><strong>${escapeHtml(s.name)}</strong><div class="small muted">${escapeHtml(s.interests.join(', '))}</div></div><div class="small muted">${escapeHtml((s.roles[0]||'member'))}</div></div>`;
    }).join('');
    const membersWrap = document.createElement('div'); membersWrap.innerHTML = membersHtml;
    card.appendChild(membersWrap);
    const btn = document.createElement('button'); btn.textContent = 'View Starter Pack';
    btn.style.marginTop='8px';
    btn.onclick = ()=>{
      const sp = starterPackFor(g);
      let text = sp.title + '\n\n';
      sp.bullets.forEach(b=> text += '• ' + b + '\n');
      text += '\nRoles:\n';
      sp.roleSpecs.forEach(r => { text += `- ${r.name} (${r.role}):\n`; r.bullets.forEach(b=> text += '   • ' + b + '\n'); });
      const vocab = buildVocab(); const textEmb = students.map(s=>textVecFor(s,vocab));
      text += '\nScoring breakdown:\n';
      text += `- interest similarity: ${Math.round(avgPairwiseTextSim(g.members, textEmb)*100)}%\n`;
      text += `- VARK variance (lower better): ${Math.round(varkVariance(g.members)*100)}\n`;
      text += `- role coverage: ${Math.round(roleCoverage(g.members, (document.getElementById('reqRoles').value||'').split(',').map(x=>x.trim()).filter(Boolean))*100)}%\n`;
      document.getElementById('explainArea').textContent = text;
      document.getElementById('explainArea').focus();
    };
    card.appendChild(btn);
    area.appendChild(card);
  });
}

// ---------- CRUD & persistence ----------
function addProfile(obj){ students.push({...obj, id: uid()}); saveToLocal(); renderProfiles(); }
function removeProfile(id){ students = students.filter(s=>s.id!==id); saveToLocal(); renderProfiles(); renderGroups(); document.getElementById('explainArea').textContent='Select a group to see details.'; }

function saveToLocal(){ try{ localStorage.setItem('studyed_students', JSON.stringify(students)); } catch(e){ console.warn('save fail', e); } }
function loadFromLocal(){ const raw = localStorage.getItem('studyed_students'); if(raw){ try{ students = JSON.parse(raw); renderProfiles(); } catch(e){ console.warn('local parse err', e); } } }

// ---------- export/import ----------
function exportCSV(){
  if(groups.length===0){ alert('No groups'); return; }
  let csv = 'group,member,roles,interests,skills\n';
  groups.forEach((g,i)=> g.members.forEach(id=>{
    const s = students.find(x=>x.id===id);
    csv += `${i+1},"${s.name}","${s.roles.join(';')}","${s.interests.join(';')}","${s.skills.join(';')}"\n`;
  }));
  const blob = new Blob([csv], {type:'text/csv'}); const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href=url; a.download='studyed_groups.csv'; a.click(); URL.revokeObjectURL(url);
}
function exportJSON(){
  const data = {students, groups, meta:{generatedAt: Date.now()}};
  const blob = new Blob([JSON.stringify(data,null,2)],{type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href=url; a.download='studyed_demo.json'; a.click(); URL.revokeObjectURL(url);
}
function importJSONFile(file){
  const reader = new FileReader();
  reader.onload = e => {
    try { const obj = JSON.parse(e.target.result); if(obj.students) { students = obj.students; saveToLocal(); renderProfiles(); renderGroups(); alert('Imported demo JSON'); } else alert('Invalid JSON file'); }
    catch(err){ alert('Import failed: ' + err.message); }
  };
  reader.readAsText(file);
}

// ---------- UI wiring ----------
document.getElementById('addBtn').addEventListener('click', ()=>{
  const name = document.getElementById('name').value.trim() || 'Student ' + (students.length+1);
  const interests = document.getElementById('interests').value.split(',').map(x=>x.trim()).filter(Boolean);
  const skills = document.getElementById('skills').value.split(',').map(x=>x.trim()).filter(Boolean);
  const roles = document.getElementById('roles').value.split(',').map(x=>x.trim()).filter(Boolean);
  const vark = {v:+document.getElementById('vark_v').value||0, a:+document.getElementById('vark_a').value||0, r:+document.getElementById('vark_r').value||0, k:+document.getElementById('vark_k').value||0};
  addProfile({name, interests, skills, roles, vark});
  ['name','interests','skills','roles'].forEach(id=>document.getElementById(id).value='');
});

document.getElementById('seedBtn').addEventListener('click', ()=>{
  students = [
    {id:uid(), name:'Anna Kowalska', interests:['consulting'], skills:['presenting','research'], roles:['presenter'], vark:{v:30,a:20,r:20,k:30}},
    {id:uid(), name:'Marek Zielinski', interests:['consulting','finance'], skills:['analysis','excel'], roles:['analyst'], vark:{v:15,a:10,r:55,k:20}},
    {id:uid(), name:'Ola Nowak', interests:['ux','design'], skills:['design','presentation'], roles:['designer'], vark:{v:50,a:10,r:20,k:20}},
    {id:uid(), name:'Piotr J', interests:['data','consulting'], skills:['python','analysis'], roles:['analyst','researcher'], vark:{v:20,a:20,r:20,k:40}},
    {id:uid(), name:'Sara M', interests:['marketing'], skills:['writing','research'], roles:['writer'], vark:{v:25,a:35,r:30,k:10}},
    {id:uid(), name:'Igor P', interests:['consulting','entrepreneurship'], skills:['presenting','strategy'], roles:['presenter','coordinator'], vark:{v:35,a:25,r:20,k:20}},
    {id:uid(), name:'Ella R', interests:['consulting'], skills:['project','coordination'], roles:['coordinator'], vark:{v:20,a:30,r:25,k:25}}
  ];
  saveToLocal(); renderProfiles();
});

document.getElementById('clearBtn').addEventListener('click', ()=>{ if(confirm('Clear all profiles?')){ students=[]; groups=[]; saveToLocal(); renderProfiles(); renderGroups(); document.getElementById('explainArea').textContent='Select a group to see details.'; } });

document.getElementById('matchBtn').addEventListener('click', ()=>{
  const groupSize = Math.max(2, +document.getElementById('groupSize').value || 4);
  const reqRoles = (document.getElementById('reqRoles').value||'').split(',').map(x=>x.trim()).filter(Boolean);
  let iw=+document.getElementById('wInterest').value, vw=+document.getElementById('wVark').value, rw=+document.getElementById('wRole').value;
  const sum = iw+vw+rw || 1; const weights = {interest: iw/sum, vark: vw/sum, role: rw/sum};
  groups = matchEngine(groupSize, reqRoles, weights);
  renderGroups();
  logMatchMetrics();
});

document.getElementById('exportCsvBtn').addEventListener('click', exportCSV);
document.getElementById('exportJsonBtn').addEventListener('click', exportJSON);
document.getElementById('importJsonBtn').addEventListener('click', ()=> fileInput.click());

const fileInput = document.createElement('input'); fileInput.type='file'; fileInput.accept='.json'; fileInput.style.display='none';
fileInput.addEventListener('change', ()=>{ if(fileInput.files[0]) importJSONFile(fileInput.files[0]); });
document.body.appendChild(fileInput);

// ---------- small metrics log ----------
function logMatchMetrics(){
  if(!groups || groups.length===0) return;
  const avgScore = Math.round(groups.reduce((s,g)=>s+g.score,0)/groups.length);
  console.info('StudyEd Metrics: groups=', groups.length, 'avgScore=', avgScore, 'students=', students.length);
}

// ---------- utility ----------
function escapeHtml(s){ return String(s).replace(/[&<>"']/g, m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }

// ---------- init persistence + seed ----------
loadFromLocal();
if(students.length===0) document.getElementById('seedBtn').click();

// ---------- hero lottie ----------
(function initLottie(){
  const lottiePath = 'https://assets2.lottiefiles.com/packages/lf20_jcikwtux.json'; // changeable
  try{
    if(window.lottie){ lottie.loadAnimation({ container: document.getElementById('heroLottie'), renderer:'svg', loop:true, autoplay:true, path: lottiePath }); }
  }catch(e){ console.warn('lottie failed', e); }
})();

// ---------- smooth scroll for internal nav -->
document.querySelectorAll('a[href^="#"]').forEach(a=>{
  a.addEventListener('click', e=>{
    const href=a.getAttribute('href');
    if(href.startsWith('#')){ e.preventDefault(); const target=document.querySelector(href); if(target) window.scrollTo({ top: target.offsetTop-20, behavior:'smooth' }); }
  });
});

// small console guidance for judges
console.info('StudyEd demo loaded. Run "Run match" after seeding samples. Export JSON/CSV to save scenarios.');
</script>
</body>
</html>

